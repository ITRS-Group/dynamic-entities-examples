<gateway compatibility="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://schema.itrsgroup.com/RA5.1.0-200305/gateway.xsd">
    <probes>
        <virtualProbe name="gateway"></virtualProbe>
    </probes>
    <dynamicEntities>
        <mappings>
            <mapping name="Container">
                <!--Container-->
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>pod_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>container_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>namespace</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>kubernetes_app_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>pod_name</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <dimension>built-sampler</dimension>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>container_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>jvm_memory_pool_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>jvm_memory_gc_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>thread_state</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>volume_name</dimension>
                    </directoryMapping>
                </rowMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Namespace</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>namespace</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Application</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>kubernetes_app_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>kubernetes_container_fs</prefix>
                                <value>container_fs</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_container</prefix>
                                <value>container</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_event</prefix>
                                <value>event</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_node</prefix>
                                <value>node</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_pod</prefix>
                                <value>pod</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent</prefix>
                                <value>collection_agent</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_events</prefix>
                                <value>events</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_logs</prefix>
                                <value>logs</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_metrics</prefix>
                                <value>metrics</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_gc</prefix>
                                <value>memory_gc</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_pool_heap</prefix>
                                <value>memory_pool_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_pool_non_heap</prefix>
                                <value>memory_pool_non_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_heap</prefix>
                                <value>memory_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_non_heap</prefix>
                                <value>memory_non_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_os</prefix>
                                <value>os</value>
                            </choice>
                            <choice>
                                <prefix>jvm_runtime</prefix>
                                <value>runtime</value>
                            </choice>
                            <choice>
                                <prefix>jvm_thread_states</prefix>
                                <value>thread_states</value>
                            </choice>
                            <choice>
                                <prefix>jvm_thread</prefix>
                                <value>thread</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>misc</fallback>
                    </choice>
                    <choice>
                        <name>built-sampler</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>collection</prefix>
                                <value>Geneos</value>
                            </choice>
                            <choice>
                                <prefix>jvm</prefix>
                                <value>JVM</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes</prefix>
                                <value>Kube</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>App</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
            <mapping name="Pod">
                <!--POD-->
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>pod_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>kubernetes_app_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>namespace</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>pod_name</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <static>
                            <data>Kube</data>
                        </static>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>pod_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>volume_name</dimension>
                    </directoryMapping>
                </rowMapping>
                <streamMapping>
           
       </streamMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Namespace</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>namespace</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Application</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>kubernetes_app_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>kubernetes_pod_network</prefix>
                                <value>pod_network</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_pod_fs</prefix>
                                <value>pod_fs</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_event</prefix>
                                <value>event</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_node</prefix>
                                <value>node</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_pod</prefix>
                                <value>pod</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>misc</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
            <mapping name="Node">
                <!--Node-->
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>node_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>node_name</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <static>
                            <data>Kube</data>
                        </static>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>node_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>interface_name</dimension>
                    </directoryMapping>
                </rowMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Namespace</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <data>cluster</data>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>kubernetes_event</prefix>
                                <value>event</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_node_network</prefix>
                                <value>node_network</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_node</prefix>
                                <value>node</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>misc</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
            <mapping name="System">
                <!--Catch-all Managed Entity for Resplicaset, Deployment, etc. events-->
                <matchCriteria></matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <static>
                            <data>system</data>
                        </static>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <static>
                            <data>Kube</data>
                        </static>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <static>
                            <data>misc</data>
                        </static>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <metricName></metricName>
                    </directoryMapping>
                </rowMapping>
                <streamMapping></streamMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Namespace</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <data>kube-system</data>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
            </mapping>
        </mappings>
        <mappingTypes>
            <mappingType name="Kubernetes">
                <mappings>
                    <mapping ref="Container"></mapping>
                    <mapping ref="Pod"></mapping>
                    <mapping ref="Node"></mapping>
                    <mapping ref="System"></mapping>
                </mappings>
                <samplers>
                    <sampler ref="KubeFKM"></sampler>
                </samplers>
                <entityTimeout>600</entityTimeout>
            </mappingType>
        </mappingTypes>
    </dynamicEntities>
    <types>
        <type name="Health">
            <sampler ref="Health"></sampler>
        </type>
        <type name="Gateway">
            <sampler ref="Self"></sampler>
            <sampler ref="Probes"></sampler>
            <sampler ref="ConnectionData"></sampler>
        </type>
    </types>
    <samplers>
        <samplerGroup name="Gateway">
            <sampler name="ConnectionData">
                <var-group>
                    <var ref="GroupName"></var>
                </var-group>
                <plugin>
                    <Gateway-clientConnectionData></Gateway-clientConnectionData>
                </plugin>
            </sampler>
            <sampler name="Self">
                <var-group>
                    <var ref="GroupName"></var>
                </var-group>
                <plugin>
                    <Gateway-gatewayData></Gateway-gatewayData>
                </plugin>
            </sampler>
            <sampler name="Probes">
                <var-group>
                    <var ref="GroupName"></var>
                </var-group>
                <plugin>
                    <Gateway-probeData></Gateway-probeData>
                </plugin>
            </sampler>
        </samplerGroup>
        <samplerGroup name="Dynamic Entities">
            <sampler name="Health">
                <sampleInterval>
                    <data>1</data>
                </sampleInterval>
                <plugin>
                    <dynamic-entities-health></dynamic-entities-health>
                </plugin>
            </sampler>
        </samplerGroup>
        <samplerGroup name="Events">
            <sampler name="KubeFKM">
                <plugin>
                    <fkm>
                        <files>
                            <file>
                                <source>
                                    <stream>
                                        <data>*</data>
                                    </stream>
                                </source>
                                <tables>
                                    <table>
                                        <severity>fail</severity>
                                        <keyTable>
                                            <data>
                                                <keys>
                                                    <key>
                                                        <setKey>
                                                            <match>
                                                                <searchString>
                                                                    <data>error</data>
                                                                </searchString>
                                                            </match>
                                                        </setKey>
                                                        <clearTime>
                                                            <data>120</data>
                                                        </clearTime>
                                                    </key>
                                                </keys>
                                            </data>
                                        </keyTable>
                                    </table>
                                    <table>
                                        <severity>warning</severity>
                                        <keyTable>
                                            <data>
                                                <keys>
                                                    <key>
                                                        <setKey>
                                                            <match>
                                                                <searchString>
                                                                    <data>.*</data>
                                                                </searchString>
                                                                <rules>REGEXP</rules>
                                                            </match>
                                                        </setKey>
                                                    </key>
                                                </keys>
                                            </data>
                                        </keyTable>
                                    </table>
                                </tables>
                            </file>
                        </files>
                    </fkm>
                </plugin>
            </sampler>
        </samplerGroup>
    </samplers>
    <rules>
        <rule name="Sampling Status">
            <targets>
                <target>/geneos/gateway/directory/probe/managedEntity/sampler/dataview/headlines/cell[(@name=&quot;samplingStatus&quot;)]</target>
            </targets>
            <priority>1</priority>
            <block>
                <if>
                    <like>
                        <dataItem>
                            <property>@value</property>
                        </dataItem>
                        <string>OK</string>
                    </like>
                    <transaction>
                        <update>
                            <property>state/@severity</property>
                            <severity>ok</severity>
                        </update>
                    </transaction>
                    <transaction>
                        <update>
                            <property>state/@severity</property>
                            <severity>warning</severity>
                        </update>
                    </transaction>
                </if>
            </block>
        </rule>
        <ruleGroup name="Kubernetes">
            <rule name="Container Memory Limit">
                <targets>
                    <target>/geneos/gateway[(@name=&quot;gw51000&quot;)]/directory/probe/managedEntity/sampler[(@name=&quot;Kube&quot;)][(@type=&quot;&quot;)]/dataview[(@name=&quot;container&quot;)]/rows/row/cell[(@column=&quot;kubernetes_container_memory_limit_percentage&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <gte>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <integer>100</integer>
                        </gte>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>critical</severity>
                            </update>
                        </transaction>
                        <if>
                            <gte>
                                <dataItem>
                                    <property>@value</property>
                                </dataItem>
                                <integer>70</integer>
                            </gte>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>warning</severity>
                                </update>
                            </transaction>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>ok</severity>
                                </update>
                            </transaction>
                        </if>
                    </if>
                </block>
            </rule>
            <rule name="Container Memory Requested">
                <targets>
                    <target>/geneos/gateway[(@name=&quot;gw51000&quot;)]/directory/probe/managedEntity/sampler[(@name=&quot;Kube&quot;)][(@type=&quot;&quot;)]/dataview[(@name=&quot;container&quot;)]/rows/row/cell[(@column=&quot;kubernetes_container_memory_request_percentage&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <gte>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <integer>100</integer>
                        </gte>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>critical</severity>
                            </update>
                        </transaction>
                        <if>
                            <gte>
                                <dataItem>
                                    <property>@value</property>
                                </dataItem>
                                <integer>70</integer>
                            </gte>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>warning</severity>
                                </update>
                            </transaction>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>ok</severity>
                                </update>
                            </transaction>
                        </if>
                    </if>
                </block>
            </rule>
            <rule name="Kubernetes FKM">
                <targets>
                    <target>/geneos/gateway[(@name=&quot;gw51000&quot;)]/directory/probe/managedEntity/sampler[(@name=&quot;KubeFKM&quot;)][(@type=&quot;&quot;)]/dataview/rows/row/cell[(@column=&quot;status&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <like>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <string>FAIL*</string>
                        </like>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>critical</severity>
                            </update>
                        </transaction>
                        <if>
                            <like>
                                <dataItem>
                                    <property>@value</property>
                                </dataItem>
                                <string>WARN*</string>
                            </like>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>warning</severity>
                                </update>
                            </transaction>
                            <if>
                                <equal>
                                    <dataItem>
                                        <property>@value</property>
                                    </dataItem>
                                    <string>OK</string>
                                </equal>
                                <transaction>
                                    <update>
                                        <property>state/@severity</property>
                                        <severity>ok</severity>
                                    </update>
                                </transaction>
                                <transaction>
                                    <update>
                                        <property>state/@severity</property>
                                        <severity>undefined</severity>
                                    </update>
                                </transaction>
                            </if>
                        </if>
                    </if>
                </block>
            </rule>
        </ruleGroup>
    </rules>
    <operatingEnvironment>
        <gatewayName></gatewayName>
        <var name="Environment">
            <string>Kubernetes</string>
        </var>
        <var name="meName">
            <macro>
                <managedEntityName></managedEntityName>
            </macro>
        </var>
        <var name="probeName">
            <macro>
                <netprobeName></netprobeName>
            </macro>
        </var>
        <var name="probeHost">
            <macro>
                <netprobeHost></netprobeHost>
            </macro>
        </var>
        <var name="GroupName">
            <macro>
                <gatewayName></gatewayName>
            </macro>
        </var>
    </operatingEnvironment>
</gateway>
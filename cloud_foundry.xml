<gateway compatibility="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://schema.itrsgroup.com/RA5.1.0-200301/gateway.xsd">
    <probes>
        <virtualProbe name="vprobe"></virtualProbe>
    </probes>
    <managedEntities>
        <managedEntity name="Gateway PCF">
            <virtualProbe ref="vprobe"></virtualProbe>
            <attribute name="Type">Static</attribute>
            <attribute name="Environment">Geneos</attribute>
            <addTypes>
                <type ref="Health"></type>
            </addTypes>
            <sampler ref="ConnectionData"></sampler>
            <sampler ref="Self"></sampler>
            <sampler ref="Probes"></sampler>
        </managedEntity>
    </managedEntities>
    <dynamicEntities>
        <mappings>
            <mapping name="Application">
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>deployment</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>job</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>source_id</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>origin</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>application_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>org_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>space_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>application_name</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <static>
                            <data>PCF</data>
                        </static>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>source_id</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>cf_instance_index</dimension>
                    </directoryMapping>
                </rowMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Deployment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>deployment</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>cf_memoryStats</prefix>
                                <value>memory</value>
                            </choice>
                            <choice>
                                <prefix>cf_container</prefix>
                                <value>container</value>
                            </choice>
                            <choice>
                                <prefix>cf_Capacity</prefix>
                                <value>capacity</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_pod</prefix>
                                <value>pod</value>
                            </choice>
                            <choice>
                                <prefix>jvm_</prefix>
                                <value>jvm</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent</prefix>
                                <value>collection_agent</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>custom</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
            <mapping name="CF">
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>deployment</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>job</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>source_id</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                    <matchCriterion>
                        <source>
                            <dimension>origin</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>origin</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <dimension>job</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>metric_version</dimension>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>ip</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>source_id</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>cf_instance_index</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>direction</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>request-type</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>loggregator</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>endpoint</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>query</dimension>
                    </directoryMapping>
                </rowMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Deployment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>deployment</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>cf_memoryStats</prefix>
                                <value>memory</value>
                            </choice>
                            <choice>
                                <prefix>cf_container</prefix>
                                <value>container</value>
                            </choice>
                            <choice>
                                <prefix>cf_Capacity</prefix>
                                <value>capacity</value>
                            </choice>
                            <choice>
                                <prefix>jvm_</prefix>
                                <value>jvm</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent</prefix>
                                <value>collection_agent</value>
                            </choice>
                            <choice>
                                <prefix>cf_dropped</prefix>
                                <value>dropped</value>
                            </choice>
                            <choice>
                                <prefix>cf_Request</prefix>
                                <value>requests</value>
                            </choice>
                            <choice>
                                <prefix>cf_average_envelope</prefix>
                                <value>envelope</value>
                            </choice>
                            <choice>
                                <prefix>cf_doppler_proxy</prefix>
                                <value>doppler_proxy</value>
                            </choice>
                            <choice>
                                <prefix>cf_query</prefix>
                                <value>query</value>
                            </choice>
                            <choice>
                                <prefix>cf_absolute</prefix>
                                <value>container</value>
                            </choice>
                            <choice>
                                <prefix>cf_</prefix>
                                <value>cf_metrics</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>custom</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
            <mapping name="Agent">
                <matchCriteria>
                    <matchCriterion>
                        <source>
                            <dimension>application_name</dimension>
                        </source>
                        <pattern>.+</pattern>
                    </matchCriterion>
                </matchCriteria>
                <entityMapping>
                    <directoryMapping>
                        <dimension>application_name</dimension>
                    </directoryMapping>
                </entityMapping>
                <samplerMapping>
                    <directoryMapping>
                        <dimension>built-sampler</dimension>
                    </directoryMapping>
                </samplerMapping>
                <dataviewMapping>
                    <directoryMapping>
                        <dimension>built-dv</dimension>
                    </directoryMapping>
                </dataviewMapping>
                <rowMapping>
                    <directoryMapping>
                        <dimension>origin</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>jvm_memory_pool_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>jvm_memory_gc_name</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>thread_state</dimension>
                    </directoryMapping>
                    <directoryMapping>
                        <dimension>volume_name</dimension>
                    </directoryMapping>
                </rowMapping>
                <streamMapping>
                    <directoryMapping>
                        <dimension>origin</dimension>
                    </directoryMapping>
                </streamMapping>
                <attributeMappings>
                    <attributeMapping>
                        <name>Environment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Environment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Cluster</name>
                        <directoryMappings>
                            <directoryMapping>
                                <label>cluster_name</label>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                    <attributeMapping>
                        <name>Deployment</name>
                        <directoryMappings>
                            <directoryMapping>
                                <static>
                                    <var ref="Deployment"></var>
                                </static>
                            </directoryMapping>
                        </directoryMappings>
                    </attributeMapping>
                </attributeMappings>
                <labelBuilders>
                    <choice>
                        <name>built-dv</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>kubernetes_container_fs</prefix>
                                <value>container_fs</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_container</prefix>
                                <value>container</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_event</prefix>
                                <value>event</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_node</prefix>
                                <value>node</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes_pod</prefix>
                                <value>pod</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent</prefix>
                                <value>collection_agent</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_events</prefix>
                                <value>events</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_logs</prefix>
                                <value>logs</value>
                            </choice>
                            <choice>
                                <prefix>collection_agent_metrics</prefix>
                                <value>metrics</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_gc</prefix>
                                <value>memory_gc</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_pool_heap</prefix>
                                <value>memory_pool_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_pool_non_heap</prefix>
                                <value>memory_pool_non_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_heap</prefix>
                                <value>memory_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_memory_non_heap</prefix>
                                <value>memory_non_heap</value>
                            </choice>
                            <choice>
                                <prefix>jvm_os</prefix>
                                <value>os</value>
                            </choice>
                            <choice>
                                <prefix>jvm_runtime</prefix>
                                <value>runtime</value>
                            </choice>
                            <choice>
                                <prefix>jvm_thread_states</prefix>
                                <value>thread_states</value>
                            </choice>
                            <choice>
                                <prefix>jvm_thread</prefix>
                                <value>thread</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>misc</fallback>
                    </choice>
                    <choice>
                        <name>built-sampler</name>
                        <source>
                            <metricName></metricName>
                        </source>
                        <choices>
                            <choice>
                                <prefix>collection</prefix>
                                <value>Geneos</value>
                            </choice>
                            <choice>
                                <prefix>jvm</prefix>
                                <value>JVM</value>
                            </choice>
                            <choice>
                                <prefix>kubernetes</prefix>
                                <value>Kube</value>
                            </choice>
                        </choices>
                        <dimension>true</dimension>
                        <fallback>App</fallback>
                    </choice>
                </labelBuilders>
            </mapping>
        </mappings>
        <mappingTypes>
            <mappingType name="CloudFoundry">
                <mappings>
                    <mapping ref="Application"></mapping>
                    <mapping ref="CF"></mapping>
                    <mapping ref="Agent"></mapping>
                </mappings>
                <samplers>
                    <sampler ref="Events"></sampler>
                </samplers>
                <entityTimeout>600</entityTimeout>
            </mappingType>
        </mappingTypes>
    </dynamicEntities>
    <types>
        <type name="Health">
            <sampler ref="Health"></sampler>
        </type>
    </types>
    <samplers>
        <samplerGroup name="Self">
            <sampler name="ConnectionData">
                <plugin>
                    <Gateway-clientConnectionData></Gateway-clientConnectionData>
                </plugin>
            </sampler>
            <sampler name="Self">
                <plugin>
                    <Gateway-gatewayData></Gateway-gatewayData>
                </plugin>
            </sampler>
            <sampler name="Probes">
                <plugin>
                    <Gateway-probeData></Gateway-probeData>
                </plugin>
            </sampler>
        </samplerGroup>
        <samplerGroup name="SAN">
            <sampler name="Health">
                <sampleInterval>
                    <data>1</data>
                </sampleInterval>
                <plugin>
                    <dynamic-entities-health></dynamic-entities-health>
                </plugin>
            </sampler>
        </samplerGroup>
        <samplerGroup name="Events">
            <sampler name="Events">
                <var-group>
                    <data>PCF_Events</data>
                </var-group>
                <plugin>
                    <fkm>
                        <display>
                            <lastTriggerInStatus>
                                <data>false</data>
                            </lastTriggerInStatus>
                        </display>
                        <files>
                            <file>
                                <source>
                                    <stream>
                                        <data>*</data>
                                    </stream>
                                </source>
                                <tables>
                                    <table>
                                        <severity>fail</severity>
                                        <keyTable>
                                            <data>
                                                <keys>
                                                    <key>
                                                        <setKey>
                                                            <match>
                                                                <searchString>
                                                                    <data>error</data>
                                                                </searchString>
                                                            </match>
                                                        </setKey>
                                                        <clearTime>
                                                            <data>120</data>
                                                        </clearTime>
                                                    </key>
                                                </keys>
                                            </data>
                                        </keyTable>
                                    </table>
                                    <table>
                                        <severity>warning</severity>
                                        <keyTable>
                                            <data>
                                                <keys>
                                                    <key>
                                                        <setKey>
                                                            <match>
                                                                <searchString>
                                                                    <data>.*</data>
                                                                </searchString>
                                                                <rules>REGEXP</rules>
                                                            </match>
                                                        </setKey>
                                                    </key>
                                                </keys>
                                            </data>
                                        </keyTable>
                                    </table>
                                </tables>
                            </file>
                        </files>
                    </fkm>
                </plugin>
            </sampler>
        </samplerGroup>
    </samplers>
    <commands>
        <command name="GatewayLog">
            <targets>
                <target>/geneos/gateway/directory</target>
            </targets>
            <userCommand>
                <type>script</type>
                <runLocation>gateway</runLocation>
                <args>
                    <arg>
                        <static>tail</static>
                    </arg>
                    <arg>
                        <static>-200</static>
                    </arg>
                    <arg>
                        <static>gateway.log</static>
                    </arg>
                </args>
            </userCommand>
        </command>
        <command name="ShowApplicationLogs">
            <targets>
                <target>/geneos/gateway/directory/probe/managedEntity/sampler[(@name=&quot;Events&quot;)]/dataview[(@name=&quot;Events&quot;)]/rows/row/cell</target>
            </targets>
            <userCommand>
                <type>script</type>
                <runLocation>netprobe</runLocation>
                <args>
                    <arg>
                        <static>cf</static>
                    </arg>
                    <arg>
                        <static>logs</static>
                    </arg>
                    <arg>
                        <xpath>ancestor-or-self::managedEntity/@name</xpath>
                    </arg>
                    <arg>
                        <static>--recent</static>
                    </arg>
                </args>
            </userCommand>
        </command>
        <command name="CFLoginForLogs">
            <targets>
                <target>/geneos/gateway/directory/probe/managedEntity/sampler[(@name=&quot;Events&quot;)]/dataview[(@name=&quot;Events&quot;)]/rows/row/cell</target>
            </targets>
            <userCommand>
                <type>script</type>
                <runLocation>netprobe</runLocation>
                <args>
                    <arg>
                        <static>cf login -u</static>
                    </arg>
                    <arg>
                        <userInput>
                            <description>Username</description>
                            <singleLineString></singleLineString>
                            <requiredArgument>true</requiredArgument>
                        </userInput>
                    </arg>
                    <arg>
                        <static>-p</static>
                    </arg>
                    <arg>
                        <userInput>
                            <description>Password</description>
                            <singleLineString></singleLineString>
                            <requiredArgument>true</requiredArgument>
                        </userInput>
                    </arg>
                    <arg>
                        <static>-o cfdev-org -a https://api.dev.cfdev.sh --skip-ssl-validation</static>
                    </arg>
                </args>
            </userCommand>
        </command>
    </commands>
    <rules>
        <ruleGroup name="Mappings">
            <rule name="Invalid Metric Count">
                <targets>
                    <target>/geneos/gateway/directory/probe/managedEntity/sampler[(@name=&quot;Health&quot;)][(@type=&quot;Health&quot;)]/dataview[(@name=&quot;InvalidMetrics&quot;)]/headlines/cell[(@name=&quot;numberDetected&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <gt>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <integer>10</integer>
                        </gt>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>critical</severity>
                            </update>
                        </transaction>
                        <if>
                            <gt>
                                <dataItem>
                                    <property>@value</property>
                                </dataItem>
                                <integer>0</integer>
                            </gt>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>warning</severity>
                                </update>
                            </transaction>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>ok</severity>
                                </update>
                            </transaction>
                        </if>
                    </if>
                </block>
            </rule>
            <rule name="Entity Issues">
                <targets>
                    <target>/geneos/gateway/directory/probe/managedEntity/sampler[(@name=&quot;Health&quot;)][(@type=&quot;Health&quot;)]/dataview[(@name=&quot;Entities&quot;)]/rows/row/cell[(@column=&quot;state&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <equal>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <string>ACCEPTED</string>
                        </equal>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>ok</severity>
                            </update>
                        </transaction>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>warning</severity>
                            </update>
                        </transaction>
                    </if>
                </block>
            </rule>
            <rule name="Sampling Status">
                <targets>
                    <target>/geneos/gateway/directory/probe/managedEntity/sampler/dataview/headlines/cell[(@name=&quot;samplingStatus&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <like>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <string>OK</string>
                        </like>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>ok</severity>
                            </update>
                        </transaction>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>warning</severity>
                            </update>
                        </transaction>
                    </if>
                </block>
            </rule>
        </ruleGroup>
        <ruleGroup name="Events">
            <rule name="FKM">
                <targets>
                    <target>/geneos/gateway/directory/probe/managedEntity/sampler[(@name=&quot;Events&quot;)]/dataview[(@name=&quot;Events&quot;)]/rows/row/cell[(@column=&quot;status&quot;)]</target>
                </targets>
                <priority>1</priority>
                <block>
                    <if>
                        <like>
                            <dataItem>
                                <property>@value</property>
                            </dataItem>
                            <string>FAIL*</string>
                        </like>
                        <transaction>
                            <update>
                                <property>state/@severity</property>
                                <severity>critical</severity>
                            </update>
                        </transaction>
                        <if>
                            <like>
                                <dataItem>
                                    <property>@value</property>
                                </dataItem>
                                <string>WARN*</string>
                            </like>
                            <transaction>
                                <update>
                                    <property>state/@severity</property>
                                    <severity>warning</severity>
                                </update>
                            </transaction>
                            <if>
                                <equal>
                                    <dataItem>
                                        <property>@value</property>
                                    </dataItem>
                                    <string></string>
                                </equal>
                                <transaction>
                                    <update>
                                        <property>state/@severity</property>
                                        <severity>undefined</severity>
                                    </update>
                                </transaction>
                                <transaction>
                                    <update>
                                        <property>state/@severity</property>
                                        <severity>ok</severity>
                                    </update>
                                </transaction>
                            </if>
                        </if>
                    </if>
                </block>
            </rule>
        </ruleGroup>
    </rules>
    <selfAnnouncingProbes>
        <enabled>true</enabled>
        <disconnectedProbeTimeout>30</disconnectedProbeTimeout>
    </selfAnnouncingProbes>
    <operatingEnvironment>
        <var name="Environment">
            <string>Cloud Foundry</string>
        </var>
        <var name="Deployment">
            <string>itrs</string>
        </var>
        <httpConnectionRequirements>
            <internalData>
                <acceptHosts>
                    <all></all>
                </acceptHosts>
            </internalData>
        </httpConnectionRequirements>
    </operatingEnvironment>
</gateway>